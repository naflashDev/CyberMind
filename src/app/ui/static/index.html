<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>CYBERMIND</title>
  <link rel="stylesheet" href="/ui/styles.css">
  <!-- Markdown parser (marked) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <!-- Botón fijo para mostrar/ocultar la sidebar -->
  <div class="toggle-wrapper">
    <button class="toggle-sidebar" id="btn-toggle">&laquo;</button>
  </div>

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <h1>CyberMind</h1>
    <button class="nav-button active" data-view="fastapi" id="btn-fastapi">Operaciones FastAPI</button>
    <button class="nav-button" data-view="datos" id="btn-datos">Datos</button>
    <button class="nav-button" data-view="tiny" id="btn-tiny">Noticias Tiny</button>
    <button class="nav-button" data-view="llm" id="btn-llm">CyberSentinel IA</button>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="main-content">
      <!-- Vista: FastAPI - Operaciones de los controllers -->
      <div class="view active" id="view-fastapi">
        <div style="display:flex; height:100%;">
          <!-- Left: controllers list inside the fastapi view -->
          <div class="controllers-pane">
            <h3>Services</h3>
            <div id="controllers-list"></div>
          </div>

          <!-- Right: operation form and result -->
          <div class="op-area" style="flex:1; padding:12px; box-sizing:border-box; display:flex; flex-direction:column;">
            <div style="margin-bottom:8px; display:flex; align-items:center; justify-content:space-between;">
              <h3 id="op-title" style="margin:0;">Seleccione una operación</h3>
              <div style="font-size:13px; color:#6b7280;">FastAPI API: <code>http://127.0.0.1:8000</code></div>
            </div>

            <div id="op-form" style="margin-bottom:12px;">
              <p style="color:#6b7280;">Seleccione una operación en la izquierda para ver los parámetros y ejecutarla.</p>
            </div>

            <div style="flex:1; overflow:auto;">
              <div id="op-result" style="display:none; background:#0b1220; color:#e6eef8; padding:12px; border-radius:6px; box-sizing:border-box;"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="view" id="view-datos">
        <div class="iframe-placeholder" data-src="http://127.0.0.1:5601/">
          <button class="load-iframe-btn">Cargar OpenSearch Dashboards</button>
        </div>
      </div>

      <!-- Vista: Noticias Tiny (Tiny RSS en 127.0.0.1:8280/tt-rss/) -->
      <div class="view" id="view-tiny">
        <div class="iframe-placeholder" data-src="http://127.0.0.1:8280/tt-rss/">
          <button class="load-iframe-btn">Cargar Tiny Tiny RSS</button>
        </div>
      </div>

      <!-- Vista LLM full-size -->
      <div class="view" id="view-llm">
        <div id="llm-panel">
          <h2>LLM Console (Cyberintelligence)</h2>
          <p>Interactúa con el modelo local (llama3 en Ollama) para consultar CVE y noticias procesadas.</p>
          <div id="llm-messages"></div>
          <div id="llm-input-row">
            <input id="llm-prompt" type="text"
              placeholder="Escribe tu pregunta al LLM (por ejemplo, explica un CVE o resume una noticia)..." />
            <button id="llm-send-btn">Enviar</button>
          </div>
        </div>
      </div>
      <!-- Vista: Estado del sistema -->
      <div class="view" id="view-status">
        <div style="padding:16px; box-sizing:border-box; height:100%; display:flex; flex-direction:column; gap:12px;">
          <h2>Estado del sistema</h2>
          <div style="display:flex; gap:8px; align-items:center;">
            <button id="btn-refresh-status-view" style="padding:8px 12px; border-radius:6px; border:none; background:#2563eb; color:#fff; cursor:pointer;">Actualizar</button>
            <div id="status-summary" style="color:#9aa6b2;">Cargando estado...</div>
          </div>
          <div style="flex:1; overflow:auto;">
            <pre id="status-json" style="background:#0b1220; color:#e6eef8; padding:12px; border-radius:6px; white-space:pre-wrap;">Cargando...</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- External UI logic -->
  <script src="/ui/ui.js"></script>
</body>

</html>